---
layout: post
title:  "网络故障"
date:   2008-12-28 00:00:00
faq:    ["断网了！"]
---
* content
{:toc}

本文给出一个诊断网络故障的思路，仅供参考。

<div class="callout callout-info">
<h4>排除浏览器问题</h4>
本文假设你电脑系统和浏览器是正常的。但是，确实存在因系统组件错误而导致浏览器本身出现异常的情况。
</div>

一般人会以以下两种方式上网：

1. 连接到 (自己架设的) 路由器。
2. 直接 (或通过交换机) 连接到公共网络。

## 已连接但无法上网

<div class="callout callout-info">
<h4>排除驱动问题</h4>
既然能够连接到网络，那么本文假设你电脑的驱动没有问题。不过确实存在因驱动不正确或驱动不稳定而导致网络故障的情况。
</div>


首先应该检查交换机、路由器等接口是否插紧，如果接口正常，对应的指示灯应该闪烁。

其次要确认不是网络供应商出现的问题。


### 确认电脑到路由器是否正常

未使用路由器的请跳过本节。

<div class="callout callout-info">
<h4>默认配置假设</h4>
本节假设你的路由器没有进行特别的设置，例如修改了路由器 IP，拉了黑名单或者开了限速。如果不清楚的话，最好问一下安装路由器的人。
</div>

一般情况，路由器的 IP 是 192.168.0.1 或 192.168.1.1。那到底是哪个呢？看路由器铭牌。

在浏览器中输入路由器的 IP，如果能进去，说明电脑到路由器之间是正常的，否则电脑和路由器之间有问题。

#### 检查电脑问题

一般存在以下两种情况：

1. 电脑被设置了错误的静态 IP。
2. 电脑未获取到 IP。

对于第一种情况：在图形界面中找到网络设置和对应的接口 (一般是 eth0 或 wlan0)，将 IPv4 的获取地址方法设置为 DHCP (或自动获取)。具体操作与桌面环境有关。如果希望手动修改配置文件，请找 `/etc/network/interfaces` (不同系统可能不一样)。

对于第二种情况：先重启。如果重启后仍不正常，可能是系统 DHCP 程序出现问题，当然也存在路由器出现问题的情况。如果连接到其他路由器也出现故障，那就是电脑的问题。

#### 检查路由器问题

检查路由器各项配置是否正确。如果不能确定，最简单粗暴的方法——按住路由器上的 RESET 按钮，从头开始，重新配置。

### 确认是否能访问到外部网络

百度的 IP 是 `202.108.22.5`。在浏览器输入这个 IP，应该能看到百度首页。

如果能看到百度但是仍然无法正常上网，那就是 DNS 的问题。

### 确认 DNS 是否正常

<div class="callout callout-info">
<h4>这才是重点</h4>
多数人遇到网络故障，都是因为 DNS 未正确配置。
</div>

可以根据实际情况来选择对应的 DNS，也可以干脆使用 `114.114.114.114`。

首先应该尝试在图形界面中找到网络配置，并修改 DNS 地址。如果没有图形界面或者找不到配置，可以修改 `/etc/resolv.conf`，并加入

    namespace 114.114.114.114

## 无线网卡不可用

目前 Linux 对无线网卡的支持比过去好多了——虽然不一定支持丰富的扩展功能，但是最起码能联网了。

如果无线网卡不可用，那么可能存在两种情况：一种是未安装驱动 (例如需要安装私有驱动)，另一种是无线开关被错误地关闭。

### 未安装驱动

很多无线网卡驱动都已经集成到 Linux 内核中，但是 Boardcom 牌的无线网卡的驱动就没有。

因此要设法通过有线网卡连接到网络，然后安装 `firmware-b43-installer` 或 `firmware-b43legacy-installer` 或类似的软件包。

这两个软件可以安装以下型号的无线网卡：

* BCM4301
* BCM4306
* BCM4311
* BCM4318
* BCM4321
* BCM4322 (只有 14e4:432b);
* BCM4312

如果不是这些型号的，那么还是换网卡吧。

### 无线开关

这个问题不常见，因此目前还总结不出东西。
